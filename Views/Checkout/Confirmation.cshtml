@model DnTech_Ecommerce.ViewModels.OrderConfirmationViewModel
@using DnTech_Ecommerce.Models.Enums
@{
    ViewData["Title"] = "Pedido Confirmado";
    Layout = "_Layout";
}

<div class="container py-5">
    <!-- Mensaje de Confirmación -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-8 text-center">
            <div class="mb-4">
                <div class="success-animation">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 6rem;"></i>
                </div>
            </div>
            <h1 class="fw-bold mb-3">¡Pedido Confirmado!</h1>
            <p class="lead text-muted mb-4">
                Gracias por tu compra. Tu pedido ha sido recibido y está siendo procesado.
            </p>
            <div class="alert alert-info d-inline-block">
                <i class="bi bi-info-circle me-2"></i>
                Número de Pedido: <strong class="fs-5">@Model.OrderNumber</strong>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Detalles del Pedido -->
        <div class="col-lg-8">
            <!-- Información del Pedido -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-receipt me-2"></i>Información del Pedido
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong class="text-muted d-block">Número de Pedido</strong>
                            <span class="fs-5">@Model.OrderNumber</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-muted d-block">Fecha del Pedido</strong>
                            <span>@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-muted d-block">Estado</strong>
                            <span class="badge bg-@GetStatusColor(Model.Status) fs-6">
                                @GetStatusText(Model.Status)
                            </span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong class="text-muted d-block">Método de Pago</strong>
                            <span>@GetPaymentMethodText(Model.PaymentMethod)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Productos Pedidos -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-box-seam me-2"></i>Productos Pedidos
                    </h5>
                </div>
                <div class="card-body">
                    @foreach (var item in Model.Items)
                    {
                        <div class="row align-items-center mb-3 pb-3 border-bottom">
                            <div class="col-md-2 col-3">
                                <img src="@item.ProductImage" class="img-fluid rounded"
                                     alt="@item.ProductName" style="height: 80px; object-fit: cover;">
                            </div>
                            <div class="col-md-6 col-9">
                                <h6 class="mb-1">@item.ProductName</h6>
                                @if (!string.IsNullOrEmpty(item.ProductSku))
                                {
                                    <small class="text-muted">SKU: @item.ProductSku</small>
                                }
                                <div class="mt-1">
                                    <small class="text-muted">Cantidad: @item.Quantity</small>
                                </div>
                            </div>
                            <div class="col-md-2 col-6">
                                <small class="text-muted d-block">Precio unitario</small>
                                <span>$@item.Price.ToString("N2")</span>
                            </div>
                            <div class="col-md-2 col-6 text-end">
                                <small class="text-muted d-block">Subtotal</small>
                                <strong class="text-primary">$@item.TotalPrice.ToString("N2")</strong>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- Información de Envío -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-truck me-2"></i>Dirección de Envío
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><strong>@Model.ShippingFullName</strong></p>
                            <p class="mb-1">@Model.ShippingAddress</p>
                            <p class="mb-1">
                                @Model.ShippingCity@(!string.IsNullOrEmpty(Model.ShippingState) ? ", " + Model.ShippingState : ""),
                                @Model.ShippingPostalCode
                            </p>
                            <p class="mb-0">@Model.ShippingCountry</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1">
                                <i class="bi bi-envelope me-2"></i>
                                <a href="mailto:@Model.ShippingEmail">@Model.ShippingEmail</a>
                            </p>
                            <p class="mb-0">
                                <i class="bi bi-telephone me-2"></i>
                                <a href="tel:@Model.ShippingPhone">@Model.ShippingPhone</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen del Pedido -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                <div class="card-header bg-white border-0">
                    <h5 class="fw-bold mb-0">
                        <i class="bi bi-calculator me-2"></i>Resumen
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Subtotal</span>
                        <span>$@Model.Subtotal.ToString("N2")</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Envío</span>
                        @if (Model.ShippingCost == 0)
                        {
                            <span class="text-success">¡Gratis!</span>
                        }
                        else
                        {
                            <span>$@Model.ShippingCost.ToString("N2")</span>
                        }
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span class="text-muted">Impuestos</span>
                        <span>$@Model.Tax.ToString("N2")</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-4">
                        <span class="fw-bold fs-5">Total</span>
                        <span class="fw-bold fs-4 text-primary">$@Model.Total.ToString("N2")</span>
                    </div>

                    <!-- Acciones -->
                    <div class="d-grid gap-2">
                        <a href="#" class="btn btn-outline-primary" onclick="window.print(); return false;">
                            <i class="bi bi-printer me-2"></i>Imprimir Pedido
                        </a>
                        <a asp-controller="Products" asp-action="Index" class="btn btn-primary">
                            <i class="bi bi-shop me-2"></i>Seguir Comprando
                        </a>
                        <a asp-controller="Account" asp-action="Orders" class="btn btn-outline-secondary">
                            <i class="bi bi-list-ul me-2"></i>Ver Mis Pedidos
                        </a>
                    </div>

                    <!-- Información adicional -->
                    <div class="alert alert-info mt-4 mb-0">
                        <small>
                            <i class="bi bi-info-circle me-1"></i>
                            <strong>¿Qué sigue?</strong><br>
                            Recibirás un email de confirmación con los detalles de tu pedido y el seguimiento de envío.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Siguiente pasos -->
    <div class="row mt-5">
        <div class="col-lg-12">
            <div class="card border-0 shadow-sm bg-light">
                <div class="card-body">
                    <h5 class="fw-bold mb-4 text-center">¿Qué sucede ahora?</h5>
                    <div class="row text-center">
                        <div class="col-md-3 mb-3">
                            <i class="bi bi-envelope-check text-primary" style="font-size: 2.5rem;"></i>
                            <h6 class="mt-3 fw-bold">1. Confirmación</h6>
                            <p class="small text-muted">Recibirás un email con los detalles de tu pedido</p>
                        </div>
                        <div class="col-md-3 mb-3">
                            <i class="bi bi-box-seam text-info" style="font-size: 2.5rem;"></i>
                            <h6 class="mt-3 fw-bold">2. Preparación</h6>
                            <p class="small text-muted">Preparamos tu pedido cuidadosamente</p>
                        </div>
                        <div class="col-md-3 mb-3">
                            <i class="bi bi-truck text-warning" style="font-size: 2.5rem;"></i>
                            <h6 class="mt-3 fw-bold">3. Envío</h6>
                            <p class="small text-muted">Tu pedido sale en camino a tu dirección</p>
                        </div>
                        <div class="col-md-3 mb-3">
                            <i class="bi bi-house-check text-success" style="font-size: 2.5rem;"></i>
                            <h6 class="mt-3 fw-bold">4. Entrega</h6>
                            <p class="small text-muted">¡Disfruta tu compra!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusText(OrderStatus status)
    {
        return status switch
        {
            OrderStatus.Pending => "Pendiente",
            OrderStatus.Processing => "Procesando",
            OrderStatus.Shipped => "Enviado",
            OrderStatus.Delivered => "Entregado",
            OrderStatus.Cancelled => "Cancelado",
            _ => "Desconocido"
        };
    }

    private string GetStatusColor(OrderStatus status)
    {
        return status switch
        {
            OrderStatus.Pending => "warning",
            OrderStatus.Processing => "info",
            OrderStatus.Shipped => "primary",
            OrderStatus.Delivered => "success",
            OrderStatus.Cancelled => "danger",
            _ => "secondary"
        };
    }

    private string GetPaymentMethodText(PaymentMethod method)
    {
        return method switch
        {
            PaymentMethod.CreditCard => "Tarjeta de Crédito",
            PaymentMethod.DebitCard => "Tarjeta de Débito",
            PaymentMethod.PayPal => "PayPal",
            PaymentMethod.BankTransfer => "Transferencia Bancaria",
            PaymentMethod.CashOnDelivery => "Pago Contra Entrega",
            _ => "Desconocido"
        };
    }
}

@section Scripts {
    <script>
        // Animación de éxito
        document.addEventListener('DOMContentLoaded', function() {
            const successIcon = document.querySelector('.success-animation i');
            successIcon.style.opacity = '0';
            successIcon.style.transform = 'scale(0)';

            setTimeout(() => {
                successIcon.style.transition = 'all 0.5s ease-out';
                successIcon.style.opacity = '1';
                successIcon.style.transform = 'scale(1)';
            }, 100);
        });

        // Actualizar contador del carrito a 0
        document.addEventListener('DOMContentLoaded', function() {
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                cartBadge.style.display = 'none';
                cartBadge.textContent = '0';
            }
        });
    </script>
}